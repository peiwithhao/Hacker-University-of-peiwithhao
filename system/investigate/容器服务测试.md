# nginx 服务配置  

```sh
docker run --security-opt "apparmor=docker-nginx"      -p 80:80 -d --name apparmor-nginx nginx
```
测试独有配置nginx AppArmor下的服务
```sh
root@peiwithhao-Standard-PC-Q35-ICH9-2009:/home/peiwithhao# wrk -t4 -c160 -d30s http://localhost:80/
Running 30s test @ http://localhost:80/
  4 threads and 160 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     2.58ms    1.82ms  43.51ms   75.46%
    Req/Sec    16.49k     1.44k   20.48k    68.75% 1968422 requests in 30.01s, 1.56GB read
Requests/sec:  65595.94
Transfer/sec:     53.36MB
root@peiwithhao-Standard-PC-Q35-ICH9-2009:/home/peiwithhao# wrk -t4 -c160 -d30s http://localhost:80/
Running 30s test @ http://localhost:80/
  4 threads and 160 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     2.44ms    1.50ms  31.57ms   72.40%
    Req/Sec    17.08k     1.01k   20.21k    71.00%
  2039196 requests in 30.00s, 1.62GB read
Requests/sec:  67963.48
Transfer/sec:     55.29MB
root@peiwithhao-Standard-PC-Q35-ICH9-2009:/home/peiwithhao# wrk -t4 -c160 -d30s http://localhost:80/
Running 30s test @ http://localhost:80/
  4 threads and 160 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     2.47ms    1.57ms  22.45ms   72.16%
    Req/Sec    16.95k     1.06k   20.36k    71.67%
  2023304 requests in 30.01s, 1.61GB read
Requests/sec:  67426.41
Transfer/sec:     54.85MB
```

# mysql 服务配置

```sh
docker run -d --name mysql-apparmor --security-opt "apparmor=docker-mysql" -e MYSQL_ROOT_PASSWORD=secret -e MYSQL_DATABASE=testdb  -p 3307:3306 mysql
```

1. 创建测试表
```sh
sysbench oltp_read_write \
  --db-driver=mysql \
  --mysql-host=127.0.0.1 \
  --mysql-port=3307 \
  --mysql-user=root \
  --mysql-password=secret \
  --mysql-db=testdb \
  --tables=4 \
  --table-size=10000 \
  prepare
```

2. 测试
```sh
sysbench oltp_read_write \
  --db-driver=mysql \
  --mysql-host=127.0.0.1 \
  --mysql-port=3307 \
  --mysql-user=root \
  --mysql-password=secret \
  --mysql-db=testdb \
  --tables=4 \
  --table-size=10000 \
  --threads=8 \
  --time=60 \
  run
```



```sh

Running the test with following options:
Number of threads: 8
Initializing random number generator from current time


Initializing worker threads...

Threads started!

SQL statistics:
    queries performed:
        read:                            326802
        write:                           93372
        other:                           46686
        total:                           466860
    transactions:                        23343  (388.98 per sec.)
    queries:                             466860 (7779.59 per sec.)
    ignored errors:                      0      (0.00 per sec.)
    reconnects:                          0      (0.00 per sec.)

General statistics:
    total time:                          60.0095s
    total number of events:              23343

Latency (ms):
         min:                                    6.17
         avg:                                   20.56
         max:                                   61.96
         95th percentile:                       30.26
         sum:                               479956.25

Threads fairness:
    events (avg/stddev):           2917.8750/11.70
    execution time (avg/stddev):   59.9945/0.00

```

---

```sh
Running the test with following options:
Number of threads: 8
Initializing random number generator from current time


Initializing worker threads...

Threads started!

SQL statistics:
    queries performed:
        read:                            312816
        write:                           89376
        other:                           44688
        total:                           446880
    transactions:                        22344  (372.31 per sec.)
    queries:                             446880 (7446.14 per sec.)
    ignored errors:                      0      (0.00 per sec.)
    reconnects:                          0      (0.00 per sec.)

General statistics:
    total time:                          60.0136s
    total number of events:              22344

Latency (ms):
         min:                                    7.70
         avg:                                   21.48
         max:                                  327.97
         95th percentile:                       30.26
         sum:                               479960.41

Threads fairness:
    events (avg/stddev):           2793.0000/11.83
    execution time (avg/stddev):   59.9951/0.00

```
---

```sh
Running the test with following options:
Number of threads: 8
Initializing random number generator from current time


Initializing worker threads...

Threads started!

SQL statistics:
    queries performed:
        read:                            329588
        write:                           94168
        other:                           47084
        total:                           470840
    transactions:                        23542  (392.26 per sec.)
    queries:                             470840 (7845.23 per sec.)
    ignored errors:                      0      (0.00 per sec.)
    reconnects:                          0      (0.00 per sec.)

General statistics:
    total time:                          60.0147s
    total number of events:              23542

Latency (ms):
         min:                                    7.47
         avg:                                   20.39
         max:                                  224.11
         95th percentile:                       28.16
         sum:                               479983.37

Threads fairness:
    events (avg/stddev):           2942.7500/10.37
    execution time (avg/stddev):   59.9979/0.00

```


# redis 服务配置

```sh
docker run -d --name apparmor-redis --security-opt apparmor=docker-redis -p 6379:6379 redis
```



```sh
redis-benchmark -h 127.0.0.1 -p 6379 -t set,lpush,get,incr -n 10000 -q
```

结果

```sh
root@peiwithhao-Standard-PC-Q35-ICH9-2009:/home/peiwithhao# redis-benchmark -h 127.0.0.1 -p 6379 -t set,lpush,get,incr -n 10000 -q
SET: 116279.06 requests per second
GET: 126582.27 requests per second
INCR: 108695.65 requests per second
LPUSH: 119047.62 requests per second

root@peiwithhao-Standard-PC-Q35-ICH9-2009:/home/peiwithhao# redis-benchmark -h 127.0.0.1 -p 6379 -t set,lpush,get,incr -n 10000 -q
SET: 117647.05 requests per second
GET: 125000.00 requests per second
INCR: 142857.14 requests per second
LPUSH: 114942.53 requests per second

root@peiwithhao-Standard-PC-Q35-ICH9-2009:/home/peiwithhao# redis-benchmark -h 127.0.0.1 -p 6379 -t set,lpush,get,incr -n 10000 -q
SET: 128205.12 requests per second
GET: 129870.13 requests per second
INCR: 133333.33 requests per second
LPUSH: 97087.38 requests per second
```


# ubuntu

```sh
docker run --rm -it --security-opt apparmor=docker-ubuntu ubuntu bash
```

```sh
root@b4d4517ef8f3:/# time dd if=/dev/zero of=testfile bs=1M count=1000
1000+0 records in
1000+0 records out
1048576000 bytes (1.0 GB, 1000 MiB) copied, 0.436296 s, 2.4 GB/s

real	0m0.545s
user	0m0.000s
sys	0m0.540s
root@b4d4517ef8f3:/# time dd if=/dev/zero of=testfile bs=1M count=1000
1000+0 records in
1000+0 records out
1048576000 bytes (1.0 GB, 1000 MiB) copied, 0.51115 s, 2.1 GB/s

real	0m0.609s
user	0m0.001s
sys	0m0.596s
root@b4d4517ef8f3:/# time dd if=/dev/zero of=testfile bs=1M count=1000
1000+0 records in
1000+0 records out
1048576000 bytes (1.0 GB, 1000 MiB) copied, 0.511954 s, 2.0 GB/s

real	0m0.614s
user	0m0.000s
sys	0m0.560s

```

# busybox


