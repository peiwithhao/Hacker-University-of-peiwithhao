# 功能
用户侧：
1. 获取命令行传递的参数:
    - 'p': 获取目标监控进程(必选)
    - 'o': 指定输出文件
2. 利用`eBPF_maps`特性,来创建rinbuffer进行内核-用户通信
3. 轮询查看ringbuffer, 该ringbuffer用来存放内核侧传递的信息

内核侧(eBPF 侧):
1. 选择`tp/raw/syscalls/sys_enter`点进行hook，检查所有syscall内容
2. 当hook命中则通过上下文`struct trace_event_raw_sys_enter *ctx`来获取详细内容，这里主要是
3. 判断是否为用户指定的进程pid,若是则获取其系统调用号，参数，并传入ringbuffer

# 注意事项
由于使用`libbpf-bootstrap`,所以需要满足`CO-RE`,需要内核版本支持`CONFIG_DEBUF_INFO_BTF`选项
虽然`linux 4.10`版本就开始支持该选项，但经测试在5.8版本其仍然不是作为默认选项来传入，
需要重新勾选对应选项来编译内核

# 使用方法
进入`minimal_legacy`文件所在目录

```sh
sudo ./minimal_legacy -p <target_pid> -o <output_file>
```

# 效果展示

```
alarm               	[00000000000000000000]
rt_sigaction        	[00000000000000000014, 00000140729051813536, 00000140729051813696, 00000000000000000008]
alarm               	[00000000000000000010]
fcntl               	[00000000000000000008, 00000000000000000007, 00000140729051813872]
alarm               	[00000000000000000000]
rt_sigaction        	[00000000000000000014, 00000140729051813536, 00000000000000000000, 00000000000000000008]
pread64             	[00000000000000000008, 00000140729051813856, 00000000000000000384, 00000000000000000000]
fcntl               	[00000000000000000008, 00000000000000000007, 00000140729051814272]
alarm               	[00000000000000000000]
rt_sigaction        	[00000000000000000014, 00000140729051813536, 00000140729051813696, 00000000000000000008]
alarm               	[00000000000000000010]
fcntl               	[00000000000000000008, 00000000000000000007, 00000140729051813872]
alarm               	[00000000000000000000]
rt_sigaction        	[00000000000000000014, 00000140729051813536, 00000000000000000000, 00000000000000000008]
pread64             	[00000000000000000008, 00000140729051813856, 00000000000000000384, 00000000000000000384]
fcntl               	[00000000000000000008, 00000000000000000007, 00000140729051814272]
alarm               	[00000000000000000000]
rt_sigaction        	[00000000000000000014, 00000140729051813536, 00000140729051813696, 00000000000000000008]
alarm               	[00000000000000000010]
fcntl               	[00000000000000000008, 00000000000000000007, 00000140729051813872]
```

其中内容第一列为系统调用名，后面列均为系统调用参数


